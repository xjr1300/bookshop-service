# マイクロサービス開発・運用　実践ガイド

Rustでの実装を試行します。

## Protocol Buffers

- Protocol Buffersのバイナリ形式は、データをフィールド名ではなく番号で識別
  - メッセージサイズが小さくなり、軽量かつ高速になる
  - 同じフィールド番号を使用すれば互換性を保てる
- 互換性を維持するために次にを守ること
  - 既存のフィールド番号を変更してはならない。
  - 削除したフィールドのフィールド番号を再利用しない。

```proto
message User {
  string username = 1;
  int32  age      = 2;
}
```

上記メッセージは、次のレイアウトのバイナリで送信される。

```text
[フィールド番号:1][型情報]["username"]
[フィールド番号:2][型情報][age]
```

## ビルドスクリプト

- `build.rs`は、パッケージのルートに配置する**ビルドスクリプト**と呼ばれる特殊なファイルで、パッケージをビルドする前に実行される
- `build.rs`は、`cargo`がパッケージをビルドする前に自動的に実行
- ビルドスクリプトの目的は、コード生成、環境変数の設定、外部ライブラリのビルドなど、通常の`cargo`のビルドでは実行できないことを行うこと
- 環境変数`OUT_DIR`は、もしパッケージにビルドスクリプトがある場合、それにビルドスクリプトがその出力を配置するフォルダに設定（`OUT_DIR`は、コンパイル中にのみ設定される）
- `OUT_DIR`で示されるディレクトリには、ビルドスクリプトによって生成されるすべての出力と中間生成物が配置される
- `OUT_DIR`で示されるディレクトリは、ビルド中のパッケージのビルドディレクトリ内にあり、該当するパッケージで意

